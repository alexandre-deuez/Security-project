<?php
#########################################################
#Liste tous les liens présents sur un site web
#Auteur : Alexandre Deuez
#########################################################

##### FUNCTIONS #####
function GetWebsiteData($website) {
$ch = curl_init();
curl_setopt($ch, CURLOPT_URL, $website);
curl_setopt($ch, CURLOPT_HEADER, 0);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); //Recevoir les données sans les afficher
$output = curl_exec($ch);
curl_close($ch);
return $output;
}

function DisplaySourceCode($string) {
$siteDataContent = preg_split('/(<[^>]*[^\/]>)/i', $string, -1, PREG_SPLIT_NO_EMPTY | PREG_SPLIT_DELIM_CAPTURE);

for ($i=0;$i<count($siteDataContent);$i++) {
	echo htmlspecialchars($siteDataContent[$i])."<br>";
	}
}

//Retourne un tableau contenant tous les liens sur la page visitée
function ListAllLink($website) {
$siteData = GetWebsiteData($website); //Récupere la page html dans la var $siteData
$siteDataContent = preg_split('/(<[^>]*[^\/]>)/i', $siteData, -1, PREG_SPLIT_NO_EMPTY | PREG_SPLIT_DELIM_CAPTURE);
$linkList = array();
for ($i=0;$i<count($siteDataContent);$i++) {
	if (preg_match("/href/i", $siteDataContent[$i])) { 	//Si la chaine "href" est trouvée \b impose une limite à href. Le i rend la recherche insensible à la casse.
		if (strpos($siteDataContent[$i], "<") == 0)
			{
			if (strlen(utf8_decode($siteDataContent[$i])) < 200 && strlen(utf8_decode($siteDataContent[$i]))>1) //Filtre les liens trop longs (ou scripts js...) et les liens vides
				{
				$siteDataContent[$i] = str_replace(CHR(32),"",$siteDataContent[$i]); //Supprime tous les espaces de la chaine
				$relLink = explode("href=\"",$siteDataContent[$i]);
				$relLink = explode("\"",$relLink[1]);
				if (substr($relLink[0], 0, 1) == "/") { //Nous rajoutons l'adresse absolue en cas de liens relatifs
					$finalLink = $website.$relLink[0];
					$linkList[] = $finalLink;
					}
				elseif (substr($relLink[0], 0, strlen($website)) == $website) { //Test si nous sommes bien sur un lien du site interne.
					$finalLink = $relLink[0];
					$linkList[] = $finalLink;
					}
				}
			}
		}
	}
	return $linkList;
}

function displayLinks($array) {
	for ($i=0;$i<count($array);$i++) {
		echo htmlspecialchars($array[$i])."<br>\n";
	}
}

###### MAIN #####

$listLinkTab = array();
$targetWebSite = "http://www.google.fr";
$listLinkTab = ListAllLink($targetWebSite);
displayLinks($listLinkTab);

?>
