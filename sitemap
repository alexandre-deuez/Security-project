<?php
#########################################################
#Liste tous les liens présents sur un site internet
#Auteur : Alexandre Deuez
#########################################################

##### FUNCTIONS #####
function GetWebsiteData($website) {
$ch = curl_init();
curl_setopt($ch, CURLOPT_URL, $website);
curl_setopt($ch, CURLOPT_HEADER, 0);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); //Recevoir les données sans les afficher
$output = curl_exec($ch);
curl_close($ch);
return $output;
}

function DisplaySourceCode($string) {
$siteDataContent = preg_split('/(<[^>]*[^\/]>)/i', $string, -1, PREG_SPLIT_NO_EMPTY | PREG_SPLIT_DELIM_CAPTURE);

for ($i=0;$i<count($siteDataContent);$i++) {
	echo htmlspecialchars($siteDataContent[$i])."<br>";
	}
}

function ListAllLink($string) {
$siteDataContent = preg_split('/(<[^>]*[^\/]>)/i', $string, -1, PREG_SPLIT_NO_EMPTY | PREG_SPLIT_DELIM_CAPTURE);
$count = 0;
for ($i=0;$i<count($siteDataContent);$i++) {
	if (preg_match("/href/i", $siteDataContent[$i])) { 	//Si la chaine "href" est trouvée \b impose une limite à href. Le i rend la recherche insensible à la casse.
		if (strpos($siteDataContent[$i], "<") == 0)
			{
			if (strlen(utf8_decode($siteDataContent[$i])) < 200 && strlen(utf8_decode($siteDataContent[$i]))>1) //Filtre les liens trop longs (ou scripts js...) et les liens vides
				{
				$siteDataContent[$i] = str_replace(CHR(32),"",$siteDataContent[$i]); //Supprime tous les espaces de la chaine
				$relLink = explode("href=\"",$siteDataContent[$i]);
				$relLink = explode("\"",$relLink[1]);
				echo htmlspecialchars($relLink[0])."<br>\n";
				$count++;
				}
			}
		}
	}
echo "Count : ".$count;
}

###### MAIN #####

$targetsite = "http://www.google.fr";
$siteData = GetWebsiteData($targetsite); //Récupere la page html dans la var $siteData
ListAllLink($siteData);

?>
